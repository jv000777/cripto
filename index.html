<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>iXO · Cripto Monitor</title>
  <meta name="theme-color" content="#0f172a" />
  <link rel="icon" href="assets/favicon.png" type="image/png" sizes="32x32" />

  <style>
    :root{
      --bg:#0f172a; --card:#162033; --head:#121a2b; --muted:#aeb6cf; --ink:#fff;
      --up:#22c55e; --down:#ef4444; --line:#2a3246; --max:980px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Arial,sans-serif}

    header{padding:16px 0 6px;text-align:center}
    .logo-wrap{width:78px;height:78px;margin:0 auto 8px;border-radius:50%;
      display:grid;place-items:center;background:radial-gradient(100px circle at 50% 45%, rgba(255,255,255,.06), transparent)}
    .logo{width:72px;height:72px;border-radius:50%;object-fit:contain;filter:brightness(1.35) contrast(1.15)}
    .title{font-size:2rem;font-weight:800;margin:2px 0 0}
    .subtitle{font-size:.9rem;color:var(--muted);margin:0 0 6px}
    .update-time{font-size:.78rem;color:#9aa3b2;margin:0 0 12px}

    .wrap{max-width:var(--max);margin:0 auto;padding:0 10px 18px}
    .card{background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 0 0 1px rgba(255,255,255,.04) inset}

    table{width:100%;border-collapse:collapse;table-layout:fixed}
    thead th{background:var(--head);color:#d2dbff;font-weight:700;border-bottom:1px solid var(--line)}
    th,td{padding:8px 6px;border-top:1px solid var(--line);font-size:12px;line-height:1.2}
    tr:nth-child(even){background:#131c2e}

    /* Columnas bien definidas para que no se monten */
    thead th.col-asset{width:46%}
    thead th.col-price{width:24%}
    thead th.col-24h{width:15%}
    thead th.col-7d{width:15%}

    .num{text-align:right;font-variant-numeric:tabular-nums;white-space:nowrap}
    .name{display:flex;flex-direction:column;gap:4px;min-width:0}
    .topline{display:flex;gap:6px;align-items:baseline;min-width:0}
    .topline strong{min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .symbol{opacity:.95;font-weight:600;font-size:.9em;white-space:nowrap}
    .mc{font-size:11px;color:#aab3d1;opacity:.95;white-space:nowrap}

    .chip{display:inline-block;padding:3px 6px;border-radius:999px;font-weight:700;font-size:10px;white-space:nowrap}
    .up{color:var(--up);background:rgba(34,197,94,.12)}
    .down{color:var(--down);background:rgba(239,68,68,.12)}

    .morebar{width:100%;background:var(--head);color:#cfd5ff;padding:11px;cursor:pointer;
      user-select:none;text-align:center;font-weight:600}
    .morebar small{opacity:.8;font-weight:400}
    footer{color:#9aa3b2;font-size:12px;text-align:center;padding:12px}

    /* iPhone (≤ 430px): letras y chips un pelín más chicos para que quepa todo */
    @media (max-width:430px){
      th,td{padding:7px 5px;font-size:11px}
      .symbol{font-size:.85em}
      .mc{font-size:10px}
      .chip{font-size:9.5px;padding:2px 5px}
      thead th.col-asset{width:50%}
      thead th.col-price{width:22%}
      thead th.col-24h{width:14%}
      thead th.col-7d{width:14%}
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-wrap">
      <img src="assets/A.PNG?v=8" alt="iXO" class="logo" />
    </div>
    <h1 class="title">iXO</h1>
    <p class="subtitle">Cripto · Monitor</p>
    <p class="update-time" id="last">Última actualización: —</p>
  </header>

  <div class="wrap">
    <div class="card">
      <table>
        <thead>
          <tr>
            <th class="col-asset">Activo / MC</th>
            <th class="num col-price">Precio (USD)</th>
            <th class="num col-24h">24h</th>
            <th class="num col-7d">7d</th>
          </tr>
        </thead>
        <tbody id="rows"><tr><td colspan="4">Cargando…</td></tr></tbody>
        <tfoot><tr><td colspan="4" id="morebar" class="morebar">MORE <small>(mostrar todos)</small></td></tr></tfoot>
      </table>
    </div>
  </div>

  <footer>© <span id="y"></span> jv000777 · GitHub Pages</footer>

  <script>
    // -------- formateadores --------
    const nfUSD0 = new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:0});
    const nfUSD2 = new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:2});
    const nfCap  = new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',notation:'compact',compactDisplay:'short',maximumFractionDigits:2});
    const nfPct  = new Intl.NumberFormat('en-US',{minimumFractionDigits:2,maximumFractionDigits:2,signDisplay:'exceptZero'});
    function fmtPrice(v){
      if (v == null) return '—';
      if (Math.abs(v) >= 1000) return nfUSD0.format(v);
      if (Math.abs(v) >= 1)    return nfUSD2.format(v);
      let s = Number(v).toFixed(6).replace(/0+$/,'').replace(/\.$/,'');
      return '$'+s;
    }
    const pct = v => (typeof v==='number') ? nfPct.format(v)+'%' : '—';

    // -------- filtro stables/derivados --------
    const EXCLUDE_IDS = new Set([
      "tether","usd-coin","dai","true-usd","pax-dollar","frax","usdd","first-digital-usd","usdp","binance-usd","gemini-dollar",
      "wrapped-bitcoin","weth","staked-ether","rocket-pool-eth","frax-ether","ankreth","cbeth","sfrxeth","reth","frxeth"
    ]);
    function shouldExcludeRaw(c){
      const id=(c.id||"").toLowerCase(), name=(c.name||"").toLowerCase(), sym=(c.symbol||"").toLowerCase();
      if (EXCLUDE_IDS.has(id)) return true;
      if (/(wrapped|weth|staked|liquid[-\s]?stak|cbeth|frxeth|sfrxeth)/i.test(id+name)) return true;
      if (/(stablecoin|^usd|usd$|usd[-\s]|^usdt$|^usdc$|^usdd$|^usdp$|^busd$|^gusd$)/i.test(id+name+sym)) return true;
      return false;
    }

    // -------- estado --------
    let FULL = [];
    let expanded = false;

    // -------- fetch CoinGecko --------
    async function load(){
      try{
        const url = 'https://api.coingecko.com/api/v3/coins/markets'
          + '?vs_currency=usd&order=market_cap_desc&per_page=200&page=1'
          + '&sparkline=false&price_change_percentage=24h,7d';
        const r = await fetch(url,{cache:'no-store',headers:{accept:'application/json'}});
        if(!r.ok) throw new Error('CG '+r.status);
        const data = await r.json();

        FULL = data.filter(x=>!shouldExcludeRaw(x))
                   .map(c=>({
                      id:c.id, name:c.name, symbol:(c.symbol||'').toUpperCase(),
                      price:c.current_price ?? null,
                      mc:c.market_cap ?? null,
                      ch24:c.price_change_percentage_24h_in_currency ?? c.price_change_percentage_24h ?? null,
                      ch7: c.price_change_percentage_7d_in_currency ?? null
                    }))
                   .sort((a,b)=>(b.mc??0)-(a.mc??0));

        document.getElementById('last').textContent =
          'Última actualización: ' + new Date().toLocaleString();

        render();
      }catch(e){
        console.error(e);
        document.getElementById('rows').innerHTML = '<tr><td colspan="4">Error al cargar</td></tr>';
      }
    }

    function rowHTML(x){
      const mcS = x.mc!=null ? nfCap.format(x.mc) : '—';
      const price = fmtPrice(x.price);
      const p24 = pct(x.ch24);
      const p7  = pct(x.ch7);
      const cls24 = (typeof x.ch24==='number') ? (x.ch24>=0?'up':'down') : '';
      const cls7  = (typeof x.ch7==='number')  ? (x.ch7 >=0?'up':'down') : '';
      return `
        <tr>
          <td>
            <div class="name">
              <div class="topline">
                <strong title="${x.name}">${x.name}</strong>
                <span class="symbol">(${x.symbol})</span>
              </div>
              <div class="mc">· MC ${mcS}</div>
            </div>
          </td>
          <td class="num">${price}</td>
          <td class="num"><span class="chip ${cls24}" title="24h">${p24}</span></td>
          <td class="num"><span class="chip ${cls7}"  title="7d">${p7}</span></td>
        </tr>`;
    }

    function render(){
      const tbody = document.getElementById('rows');
      const list = expanded ? FULL : FULL.slice(0,10);
      tbody.innerHTML = list.map(rowHTML).join('');

      const mb = document.getElementById('morebar');
      if (FULL.length <= 10){
        mb.textContent = '—'; mb.style.opacity=.6; mb.style.cursor='default';
      } else {
        mb.innerHTML = expanded ? 'LESS <small>(mostrar top-10)</small>' : 'MORE <small>(mostrar todos)</small>';
        mb.style.opacity=1; mb.style.cursor='pointer';
      }
    }

    document.getElementById('morebar').addEventListener('click', ()=>{
      if (FULL.length<=10) return;
      expanded = !expanded;
      render();
      if(!expanded) document.getElementById('morebar').scrollIntoView({behavior:'smooth',block:'center'});
    });

    document.getElementById('y').textContent = new Date().getFullYear();
    load();
    setInterval(load, 60000);
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) load(); });
  </script>
</body>
</html>