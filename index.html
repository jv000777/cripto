<!doctype html>
<html lang="es">
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>iXO · Cripto Monitor</title>
  <style>
    :root{
      --bg:#0f172a; --card:#1e293b; --head:#0b1220; --muted:#94a3b8; --ink:#fff;
      --up:#22c55e; --down:#ef4444; --line:#334155; --max:980px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Arial,sans-serif}
    header{padding:26px 16px 10px;text-align:center}
    .brand{gap:6px}
.title{font-size:52px; letter-spacing:.3px}
.subtitle{font-size:16px; color:#aeb6cf; font-weight:500}
.logo{height:72px; width:72px; object-fit:contain}
.title, .subtitle { text-shadow: 0 1px 0 rgba(0,0,0,.2); }
    .update{color:var(--muted);font-size:13px;margin:0 0 18px}
    .wrap{max-width:var(--max);margin:0 auto;padding:0 16px 28px}
    table{width:100%;border-collapse:collapse;background:var(--card);border-radius:12px;overflow:hidden}
    thead th{background:var(--head);color:#cfd5ff;text-align:left;padding:12px}
    tbody td{padding:14px 12px;border-top:1px solid var(--line)}
    .num{text-align:right;font-variant-numeric:tabular-nums}
    .up{color:var(--up);font-weight:700}
    .down{color:var(--down);font-weight:700}
    .name{display:flex;flex-direction:column}
    .mc{color:#aab3d1;font-size:12px;margin-top:4px}
    footer{color:var(--muted);text-align:center;font-size:12px;padding:22px}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img class="logo" src="assets/ixo-logo-png.png?v=2" alt="iXO" />
      <h1 class="title">iXO</h1>
      <div class="subtitle">Cripto · Monitor</div>
    </div>
    <p class="update">Última actualización: <span id="upd">—</span></p>
  </header>

  <div class="wrap">
    <table>
      <thead>
        <tr>
          <th>Activo / <span style="color:#cfd5ff">MC</span></th>
          <th class="num">Precio (USD)</th>
          <th class="num">24h</th>
          <th class="num">7d</th>
        </tr>
      </thead>
      <tbody id="rows"><tr><td colspan="4">Cargando…</td></tr></tbody>
    </table>
  </div>

  <footer>© <span id="y"></span> jv000777 · GitHub Pages</footer>

  <script>
    const nfUSD = new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:6});
    const nfPct = new Intl.NumberFormat('en-US',{minimumFractionDigits:2,maximumFractionDigits:2,signDisplay:'exceptZero'});

    // Excluir de la vista: stables y envueltos/derivados
    const EXCLUDE_IDS = new Set([
      // stablecoins
      "tether","usd-coin","dai","true-usd","pax-dollar","frax","usdd","first-digital-usd","usdp","binance-usd","gemini-dollar",
      // wrapped / staked / derivados
      "staked-ether","wrapped-bitcoin","weth","rocket-pool-eth","frax-ether","ankreth","cbeth","sfrxeth","reth","frxeth"
    ]);

    async function fetchData() {
      try {
        const res = await fetch('data/snapshot.json?ts=' + Date.now(), { cache: 'no-store' });
        const j = await res.json();

        // fecha
        const last = j.updated_at || j.timestamp || null;
        document.getElementById("upd").textContent = last ? new Date(last).toLocaleString() : "—";

        // assets -> lista
        const assets = j.assets || {};
        let list = Object.values(assets).map(v => v); // cada v: {id,name,usd,change_24h,change_7d,market_cap,...}

        // filtrar ids excluidos
        list = list.filter(x => x.id && !EXCLUDE_IDS.has(x.id.toLowerCase()));

        // ordenar por MC y tomar top-10
        list.sort((a,b) => (b.market_cap ?? 0) - (a.market_cap ?? 0));
        list = list.slice(0, 10);

        render(list);
      } catch (e) {
        console.error(e);
        document.getElementById("rows").innerHTML = `<tr><td colspan="4">Error al cargar</td></tr>`;
      }
    }

    function render(list){
      const tbody = document.getElementById("rows");
      tbody.innerHTML = "";
      list.forEach((x) => {
        const price = x.usd != null ? nfUSD.format(x.usd) : "—";
        const c24 = (typeof x.change_24h === 'number') ? nfPct.format(x.change_24h) + '%' : '—';
        const c7  = (typeof x.change_7d  === 'number') ? nfPct.format(x.change_7d)  + '%' : '—';
        const cls24 = (typeof x.change_24h === 'number') ? (x.change_24h>=0 ? 'up':'down') : '';
        const cls7  = (typeof x.change_7d  === 'number') ? (x.change_7d >=0 ? 'up':'down')  : '';
        const mcTxt = x.market_cap != null ? nfUSD.format(x.market_cap) : "—";

        tbody.insertAdjacentHTML("beforeend", `
          <tr>
            <td>
              <div class="name"><strong>${x.name || x.id}</strong>
                <span class="mc">MC: ${mcTxt}</span>
              </div>
            </td>
            <td class="num">${price}</td>
            <td class="num ${cls24}">${c24}</td>
            <td class="num ${cls7}">${c7}</td>
          </tr>
        `);
      });
    }

    // Año en footer
    document.getElementById("y").textContent = new Date().getFullYear();

    // Carga inicial + cada 60s + al volver a la pestaña
    fetchData();
    setInterval(fetchData, 60000);
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) fetchData(); });
  </script>
</body>
</html>